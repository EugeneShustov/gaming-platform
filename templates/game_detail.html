{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{ game.title }}</title>
  <link rel="stylesheet" href="{% static 'css/game_detail.css' %}">
  <style>
    .depth-rating {
      transition: opacity 0.6s ease;
    }
    .depth-rating.muted {
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div class="game-intro">
    <h2>{{ game.title }}</h2>

    <ul class="game-details">
      <li><strong>Жанр:</strong> Metroidvania</li>
      <li><strong>Разработчик:</strong> Team Cherry</li>
      <li><strong>Дата выхода:</strong> 2025-09-04</li>
      <li><strong>Платформы:</strong> PC, Xbox Series X/S, Xbox One, Nintendo Switch, PlayStation 4/5 </li>
    </ul>

    {% if game.cover_image %}
      <img src="{{ game.cover_image.url }}" alt="Обложка {{ game.title }}">
    {% endif %}

    {% if game.video_url %}
      <div class="video-wrapper">
        <iframe src="{{ game.video_url }}" title="{{ game.title }} Trailer" allowfullscreen></iframe>
      </div>
    {% else %}
      <div style="position: relative; width: 100%; max-width: 720px; margin: 2rem auto;">
        <div style="padding-top: 56.25%; position: relative;">
          <iframe src="https://www.youtube.com/embed/HYFyIinfyyc"
                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                  allowfullscreen></iframe>
        </div>
      </div>
    {% endif %}

    <p class="game-description">
      Продолжение легендарной метроидвании от Team Cherry. Играй за Хорнет, исследуй новые земли,
      сражайся с врагами и раскрой тайны, скрытые в глубинах Silksong.
    </p>

    <div class="depth-rating {% if metacritic_score is None %}muted{% endif %}">
      {% if metacritic_score is not None %}
        <span class="depth-label">Общая оценка:</span>
        <span class="depth-score">{{ metacritic_score }}/100</span>
      {% else %}
        Оценок нет
      {% endif %}
    </div>

    <section class="gallery-section">
      <h3>Галерея</h3>
      <div class="gallery">
        <div class="screenshot">
          <img src="https://i.redd.it/new-silksong-screenshots-via-nintendo-japan-v0-bmh3c2qcnfte1.jpg?width=1179&format=pjpg&auto=webp&s=d4d94ba062c8fd87b97f434a5ee3db0005d34b5b" alt="Платформинг в храме">
          <p>Трое загадочных NPC в деревне - намёк на сюжетные ветки</p>
        </div>
        <div class="screenshot">
          <img src="https://i.redd.it/new-silksong-screenshots-via-nintendo-japan-v0-c7vdz1qcnfte1.jpg?width=1179&format=pjpg&auto=webp&s=79594fead657862c5c67e745562fec3a0b194829" alt="Интерфейс и карта">
          <p>Обновлённый интерфейс и карта мира - больше деталей и навигации</p>
        </div>
        <div class="screenshot">
          <img src="https://s.yimg.com/ny/api/res/1.2/u31qKiAg2xtlfrI1LXnucQ--/YXBwaWQ9aGlnaGxhbmRlcjt3PTk2MDtoPTU0MA--/https://media.zenfs.com/en/gamesradar_237/c936e75cc326b3ef38f7c6ac161bb8a8" alt="NPC в деревне">
          <p>Сцена с новым боссом - напряжение и масштаб</p>
        </div>
        <div class="screenshot">
          <img src="https://i.redd.it/new-silksong-screenshots-via-nintendo-japan-v0-yvirf2qcnfte1.jpg?width=1179&format=pjpg&auto=webp&s=fa08b0b6a2ac349c61c0147dd8adf60b3d15b0f0" alt="Новая способность">
          <p>Хорнет использует энергетический рывок - динамика и стиль</p>
        </div>
        <div class="screenshot">
          <img src="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AA1Cbbnh.img?w=800&h=415&q=60&m=2&f=jpg" alt="Сцена с боссом">
          <p>Вертикальный храм с парящими врагами - классический платформинг</p>
        </div>
      </div>
    </section>

    <section class="discussion-section">
      <h3>Обсуждения</h3>

      {% for post in posts %}
        <div class="post">
          <strong>{{ post.author }}</strong> — {{ post.created_at|date:"d.m.Y H:i" }}<br>
          {{ post.content }}<br>

          {% if post.rating is not None %}
            <div class="post-rating">Оценка: {{ post.rating }}/10</div>
          {% endif %}

          {% for comment in post.comment_set.all %}
            <div class="comment">
              <p>{{ comment.text }}</p>
            </div>
          {% endfor %}
        </div>
      {% endfor %}

      {% if form.errors %}
        <div class="form-errors">
          {{ form.errors }}
        </div>
      {% endif %}

      <form method="post" class="post-form">
        {% csrf_token %}
        <input type="text" name="author" placeholder="Ваше имя" required>
        <textarea name="content" placeholder="Ваш пост" required></textarea>
        <label for="rating">Оценка 0–10:</label>
        <input type="number" name="rating" min="1" max="10">
        <button type="submit">Отправить</button>
      </form>
    </section>

  <script src="{% static 'js/detail_rating.js' %}"></script>
</body>
</html>

